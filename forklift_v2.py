from pprint import pprint
from collections import defaultdict
from functools import reduce

new_list = ['1908201',
            '1612708',
            '821502',
            '269415',
            '1325903',
            '175723',
            '1432802',
            '1501303',
            '1231202',
            '1658104',
            '912405',
            '886108',
            '736002',
            '2015001',
            '1481204',
            '1231401',
            '1860002',
            '1433002',
            '196602',
            '1481103',
            '1230902',
            '263202',
            '862211',
            '1676617',
            '2075201',
            '1811102',
            '905213',
            '17253',
            '1908401',
            '2165502',
            '844201',
            '47606',
            '1384401',
            '269613',
            '2061703',
            '246704',
            '776202',
            '1658304',
            '315504',
            '739941',
            '196201',
            '1910401',
            '175832',
            '1224902',
            '202663',
            '1868301',
            '1851202',
            '315802',
            '1851002',
            '772404',
            '1878201',
            '170402',
            '1913903',
            '1743604',
            '1612609',
            '1135304',
            '752005',
            '819310',
            '2074801',
            '1071602',
            '821408',
            '1574501',
            '1378506',
            '1868401',
            '2071201',
            '2041603',
            '246303',
            '776102',
            '1910501',
            '1342004',
            '1467302',
            '437008',
            '1231502',
            '752903',
            '2086501',
            '478307',
            '316101',
            '372206',
            '1609801',
            '1433202',
            '179602',
            '1342305',
            '325207',
            '119206',
            '1850902',
            '1487803',
            '1859802',
            '2074701',
            '2074901',
            '1868702',
            '738202',
            '85813',
            '47701',
            '822603',
            '1467203',
            '321705',
            '819410',
            '712702',
            '1906801',
            '371503',
            '85927',
            '735203',
            '377402',
            '2073103',
            '865503',
            '14692',
            '1868601',
            '5608',
            '1933803',
            '1273002',
            '1508203',
            '1676417',
            '1909201',
            '1896402',
            '436907',
            '1878101',
            '1750105',
            '1909901',
            '1324808',
            '825605',
            '1467102',
            '750003',
            '754403',
            '36309',
            '175916',
            '1849502',
            '1977702',
            '1896503',
            '1384301',
            '979807',
            '76820',
            '819611',
            '195715',
            '2073203',
            '752602',
            '1857603',
            '1868501',
            '485504',
            '379502',
            '1533902',
            '780015',
            '36012',
            '1487905',
            '1487603',
            '1487503',
            '2086401',
            '305804',
            '1379202',
            '170202',
            '1433102',
            '840707',
            '1675212',
            '2106001',
            '2070401',
            '912304',
            '24402',
            '1231101',
            '269514',
            '1915603',
            '1378402',
            '1346403',
            '1746102',
            '1231301',
            '932202',
            '1887602',
            '428921',
            '1324608',
            '1500301',
            '1959913',
            '1849302',
            '1906701',
            '712802',
            '1880502',
            '1441502',
            '1908301',
            '60108',
            '372112',
            '377602',
            '1019704',
            '1806201',
            '1655302',
            '1852202',
            ]
bin_list = ['1.1.1',
            '1.1.2',
            '1.1.3',
            '1.1.4',
            '1.1.5',
            '1.1.6',
            '1.1.7',
            '1.1.8',
            '1.2',
            '1.3',
            '1.4',
            '1.5',
            '10.1',
            '10.10',
            '10.2',
            '10.3',
            '10.4',
            '10.5',
            '10.6',
            '10.7',
            '10.8',
            '10.9',
            '11.1',
            '11.10',
            '11.2',
            '11.3',
            '11.4',
            '11.5',
            '11.6',
            '11.7',
            '11.8',
            '11.9',
            '12.1.1',
            '12.1.2',
            '12.1.3',
            '12.1.4',
            '12.1.5',
            '12.1.6',
            '12.1.7',
            '12.1.8',
            '12.10',
            '12.11',
            '12.12',
            '12.13',
            '12.14',
            '12.15',
            '12.16',
            '12.17',
            '12.18',
            '12.19',
            '12.20',
            '12.5',
            '12.6',
            '12.7',
            '12.8',
            '12.9',
            '13.10',
            '13.11',
            '13.12',
            '13.13',
            '13.14',
            '13.15',
            '13.16',
            '13.17',
            '13.18',
            '13.19',
            '13.20',
            '13.9',
            '2.0',
            '2.1',
            '2.2',
            '2.3',
            '2.4',
            '2.5',
            '2.6',
            '3.1A',
            '3.1B',
            '3.2A',
            '3.2B',
            '3.3A',
            '3.3B',
            '3.4A',
            '3.4B',
            '3.5A',
            '3.5B',
            '3.6A',
            '3.6B',
            '3.7A',
            '3.7B',
            '3.8A',
            '3.8B',
            '3.9A',
            '3.9B',
            '4.1',
            '4.10A',
            '4.10B',
            '4.2',
            '4.3',
            '4.4',
            '4.5',
            '4.6',
            '4.7',
            '4.8',
            '4.9',
            '5.1',
            '5.10A',
            '5.10B',
            '5.2',
            '5.3',
            '5.4',
            '5.5',
            '5.6',
            '5.7',
            '5.8A',
            '5.8B',
            '5.9',
            '6.1',
            '6.10A',
            '6.10B',
            '6.2',
            '6.3',
            '6.4',
            '6.5',
            '6.6',
            '6.7',
            '6.8',
            '6.9',
            '7.1',
            '7.10A',
            '7.10B',
            '7.2',
            '7.3',
            '7.4',
            '7.5',
            '7.6',
            '7.7',
            '7.8',
            '7.9',
            '8.1',
            '8.10A',
            '8.10B',
            '8.2',
            '8.3',
            '8.4',
            '8.5',
            '8.6',
            '8.7A',
            '8.7B',
            '8.8',
            '8.9',
            '9.1',
            '9.10',
            '9.2',
            '9.3',
            '9.4',
            '9.5',
            '9.6',
            '9.7',
            '9.8',
            '9.9',
            'A1-2',
            'A11-12',
            'A13-14',
            'A15-16',
            'A18-19',
            'A20-21',
            'A22-23',
            'A24-25',
            'A26-27',
            'A28-30',
            'A3-4',
            'A32',
            'A33',
            'A34',
            'A35',
            'A36',
            'A37',
            'A38',
            'A39-40',
            'A41-42',
            'A43-44',
            'A45-46',
            'A48-50',
            'A5-6',
            'A51-52',
            'A53-54',
            'A55-56',
            'A7-8',
            'A9-10',
            'B10-11',
            'B12-13',
            'B14-15',
            'B16-17',
            'B18-19',
            'B20-21',
            'B22-23',
            'B24-25',
            'B5-7',
            'B8-9',
            'C18-19',
            'C20-21',
            'C22-23',
            'C24-25',
            'C29-31',
            'C32-33',
            'C34-35',
            'C36-37',
            'C38-39',
            'C40-41',
            'C42-43',
            'C44-45',
            'C47-48',
            'C49-50',
            'C51-52',
            'C53-54',
            'C55-56',
            'C57-58',
            'D31-32',
            'D33-34',
            'D35-36',
            'D37-38',
            'D39-40',
            'D41-42',
            'D43-44',
            'D45-46',
            'D47-48',
            'D49-50',
            'D51-52',
            'D53-54',
            'D55-56',
            'D57-58',
            'E29-30',
            'E31-32',
            'E33-34',
            'E35-36',
            'E37-38',
            'E39-40',
            'E41-42',
            'E43-45',
            'E47-48',
            'E49-50',
            'E51-52',
            'E53-54',
            'F14-15',
            'F16-17',
            'F18-19',
            'F20-21',
            'F22-23',
            'F24-25',
            'F29-30',
            'F31-32',
            'F33-34',
            'F35-36',
            'F37-38',
            'F39-40',
            'F41-42',
            'F43-44',
            'F45-46',
            'F47-48',
            'F49-50',
            'F51-52',
            'G10',
            'G11',
            'G12',
            'G13',
            'G14',
            'G15',
            'G16',
            'G17',
            'G19',
            'G20',
            'G21',
            'G22',
            'G23',
            'G24.1',
            'G24.2',
            'G24.3',
            'G24.4',
            'G24.5',
            'G24.6',
            'G24.7',
            'G24.8',
            'HL1',
            'HL2',
            'HL3',
            'IMPORT-0',
            'IMPORT-1',
            'IMPORT-10',
            'IMPORT-11',
            'IMPORT-12',
            'IMPORT-13',
            'IMPORT-14',
            'IMPORT-15',
            'IMPORT-16',
            'IMPORT-17',
            'IMPORT-18',
            'IMPORT-19',
            'IMPORT-2',
            'IMPORT-20',
            'IMPORT-21',
            'IMPORT-22',
            'IMPORT-23',
            'IMPORT-24',
            'IMPORT-25',
            'IMPORT-26',
            'IMPORT-27',
            'IMPORT-28',
            'IMPORT-29',
            'IMPORT-3',
            'IMPORT-30',
            'IMPORT-31',
            'IMPORT-32',
            'IMPORT-33',
            'IMPORT-34',
            'IMPORT-35',
            'IMPORT-36',
            'IMPORT-37',
            'IMPORT-38',
            'IMPORT-39',
            'IMPORT-4',
            'IMPORT-40',
            'IMPORT-5',
            'IMPORT-6',
            'IMPORT-7',
            'IMPORT-8',
            'IMPORT-9',
            'L1.1',
            'L1.2',
            'L1.3',
            'L1.4',
            'L1.5',
            'L1.6',
            'L1.7',
            'L1.8',
            'L10',
            'L11',
            'L12',
            'L13',
            'L14',
            'L15',
            'L16',
            'L17',
            'L19',
            'L20',
            'L21',
            'L22',
            'L23',
            'L24',
            'L25',
            'L26',
            'L27',
            'L28',
            'L29-30',
            'L5',
            'L6',
            'L7',
            'L8',
            'L9',
            'M1',
            'M10',
            'M11',
            'M12',
            'M13',
            'M14',
            'M15',
            'M16',
            'M17',
            'M18',
            'M19',
            'M2',
            'M20',
            'M21',
            'M22',
            'M23',
            'M24',
            'M25',
            'M26-1',
            'M26-10',
            'M26-11',
            'M26-12',
            'M26-13',
            'M26-14',
            'M26-15',
            'M26-16',
            'M26-17',
            'M26-18',
            'M26-19',
            'M26-2',
            'M26-20',
            'M26-21',
            'M26-22',
            'M26-23',
            'M26-24',
            'M26-25',
            'M26-26',
            'M26-27',
            'M26-28',
            'M26-29',
            'M26-3',
            'M26-30',
            'M26-31',
            'M26-32',
            'M26-33',
            'M26-34',
            'M26-35',
            'M26-36',
            'M26-4',
            'M26-5',
            'M26-6',
            'M26-7',
            'M26-8',
            'M26-9',
            'M3',
            'M4',
            'M5',
            'M6',
            'M7',
            'M8',
            'M9',
            'MK14.1',
            'MK14.2',
            'MK14.3',
            'MK15.1',
            'MK15.2',
            'MK15.3',
            'MK16.0',
            'MK16.1',
            'MK16.2',
            'MK16.3',
            'MK17.1',
            'MK17.2',
            'MK17.3',
            'MK18.1',
            'MK18.2',
            'MK18.3',
            'MK19.1',
            'MK19.2',
            'MK19.3',
            'MK19.4',
            'MK19.5',
            'MK19.6',
            'MK20.1',
            'MK20.2',
            'MK20.3',
            'MK20.4',
            'MK20.5',
            'MK20.6',
            'MK21.1',
            'MK21.2',
            'MK21.3',
            'MK21.4',
            'MK21.5',
            'MK21.6',
            'OFFICE',
            'PR1',
            'PR2',
            'PR3',
            'R1-1',
            'R1-3',
            'R10-1',
            'R10-3',
            'R11-1',
            'R11-3',
            'R12-1',
            'R12-3',
            'R12-6',
            'R12-9',
            'R13-1',
            'R13-3',
            'R14-1',
            'R14-3',
            'R15-1',
            'R15-3',
            'R16-1',
            'R16-3',
            'R17-1',
            'R17-3',
            'R18-1',
            'R18-3',
            'R18-5',
            'R18-6',
            'R18-8',
            'R18-9',
            'R19-1',
            'R19-3',
            'R2-1',
            'R2-3',
            'R3-1',
            'R3-3',
            'R4-1',
            'R4-3',
            'R5-1',
            'R5-3',
            'R7-1',
            'R7-2',
            'R8-1',
            'R8-2',
            'R8-3',
            'R8-4',
            'R8-5',
            'R8-6',
            'R9-1',
            'R9-3',
            'R9-4',
            'R9-7',
            'S1',
            'S10',
            'S11',
            'S12',
            'S13',
            'S14',
            'S15',
            'S16',
            'S17',
            'S18',
            'S19',
            'S2',
            'S20',
            'S21',
            'S22',
            'S23',
            'S24',
            'S25',
            'S26',
            'S27',
            'S28',
            'S29',
            'S3',
            'S30',
            'S31',
            'S32',
            'S33',
            'S34',
            'S35',
            'S36',
            'S37',
            'S38',
            'S39',
            'S4',
            'S40',
            'S41',
            'S42',
            'S43',
            'S44',
            'S45',
            'S46',
            'S47',
            'S48',
            'S49',
            'S5',
            'S50',
            'S51',
            'S6',
            'S7',
            'S8',
            'S9',
            'TEMP',
            'TEMP-2',
            'VLANPAK-0',
            'VLANPAK-1',
            'VLANPAK-2',
            'VLANPAK-3',
            'VLANPAK-4',
            'VLANPAK-5',
            'VLANPAK-6',
            'VLANPAK-7',
            'VLANPAK-8',
            'VLANPAK-9',
            ]

path = 'lx02.txt'


class BinNotFound(Exception):

    def __init__(self):
        self.message = 'Проблема с поиском бина в строке(такого нет в таблице)'

    def __str__(self):
        return self.message


class MapCreator:

    def __init__(self, path):
        self.warehouse_dict = {}
        self.path = path
        self.dict = {}
        self.container = []

    def _reader(self):
        with open(self.path, 'r', encoding='utf8') as lx02:
            for line in lx02:
                for material in new_list:
                    upd_line = line.split('\t')
                    if material in upd_line:
                        self._look_for_items(upd_line)

    def _look_for_items(self, line):
        material = line[2]
        bin_pos = line[5]
        date = line[6][:-1]
        quantity = line[4].split(' ')[-1:][0]  # splits and returns the last elem as member of list
        date_reversed = '.'.join((date[-4:], date[-7:-5], date[-10:-8]))  # as the only member so [0]
        if bin_pos in bin_list:
            pass
        else:
            raise BinNotFound
        self.container.append((material, (bin_pos, (quantity, date_reversed))))

    def _dictionary(self):
        self._reader()
        d = defaultdict(list)
        for key, value in self.container:
            d[key].append(value)
        self.dict = dict(d)


class_1 = MapCreator(path)
class_1._dictionary()

# def is_eq(x):
#     return x[0] == x[0]

dict_test = {}
# pprint(class_1.dict)
for key, val_tuple in class_1.dict.items():
    c = defaultdict(list)
    for k, v in val_tuple:
        c[k].append(v)
    class_1.dict[key] = dict(c)
pprint(class_1.dict)
#     summ = sum([int(x[1]) for x in value])
#
#     print(key, summ)
